<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>沄听 - 在线音乐播放器</title>
    <meta name="description" content="简洁的在线音乐播放器">
    <meta name="theme-color" content="#1db954">
    <link rel="icon" type="image/x-icon" href="ytmusic.ico">
    <link rel="manifest" href="/manifest.json">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="bg-animation"></div>
    <div class="bg-overlay"></div>
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <i class="fas fa-music"></i>
                <span>沄听</span>
            </div>
            <button class="control-btn small" id="themeToggleBtn" title="切换主题" style="margin-right: 20px;">
                <i class="fas fa-moon"></i>
            </button>
            <div class="search-container">
                <form class="search-wrapper" onsubmit="event.preventDefault(); return false;">
                    <input type="text" class="search-input" placeholder="搜索音乐、歌手、专辑..." id="searchInput" required>
                    <select class="source-select" id="sourceSelect">
                        <option value="netease">网易云音乐</option>
                        <option value="tencent">QQ音乐</option>
                        <option value="kugou">酷狗音乐</option>
                        <option value="kuwo">酷我音乐</option>
                    </select>
                    <button type="submit" class="search-btn">
                        <i class="fas fa-search"></i>
                    </button>
                </form>
            </div>
        </div>
    </nav>
    
    <div class="main-container">
        <div class="content-section">
            <div class="tabs">
                <button class="tab-btn active" data-tab="search">
                    <i class="fas fa-search"></i> 搜索结果
                </button>
                <button class="tab-btn" data-tab="rank">
                    <i class="fas fa-chart-line"></i> 音乐排行榜
                </button>
                <button class="tab-btn" data-tab="recommend">
                    <i class="fas fa-dice"></i> 每日推荐
                </button>
                <button class="tab-btn" data-tab="parse">
                    <i class="fas fa-cloud-download-alt"></i> 解析歌单
                </button>
            </div>

            <div id="searchTab" class="tab-content active">
                <div class="search-results" id="searchResults">
                    <div class="empty-state">
                        <i class="fas fa-search"></i>
                        <div>在上方搜索框输入关键词开始搜索音乐</div>
                    </div>
                </div>
            </div>

            <div id="parseTab" class="tab-content">
                <div class="playlist-input-container">
                    <select class="playlist-source-select" id="playlistSourceSelect" style="margin-bottom: 10px;">
                        <option value="netease">网易云音乐</option>
                        <option value="tencent">QQ音乐</option>
                    </select>
                    <input type="text" id="playlistIdInput" class="playlist-input" placeholder="输入歌单ID (如: 60198) 或链接...">
                    <button class="playlist-btn">
                        <i class="fas fa-download"></i> 解析
                    </button>
                </div>
                <div class="search-results" id="parseResults">
                    <div class="empty-state">
                        <i class="fas fa-cloud-download-alt"></i>
                        <div>输入歌单ID或链接后点击解析按钮</div>
                    </div>
                </div>
            </div>

            <div id="rankTab" class="tab-content">
                <div class="rank-selector-container">
                    <div class="rank-select-group">
                        <label for="rankSourceSelect">音乐平台</label>
                        <select class="rank-source-select" id="rankSourceSelect">
                            <option value="netease">网易云音乐</option>
                            <option value="tencent">QQ音乐</option>
                            <option value="kugou">酷狗音乐</option>
                        </select>
                    </div>
                    <div class="rank-select-group">
                        <label for="rankListSelect">选择榜单</label>
                        <select class="rank-list-select" id="rankListSelect">
                            <option value="">请选择榜单</option>
                        </select>
                    </div>
                    <button class="rank-load-btn" id="rankLoadBtn">
                        <i class="fas fa-play"></i> 加载榜单
                    </button>
                </div>
                <div class="rank-songs" id="rankSongs"></div>
            </div>

            <div id="recommendTab" class="tab-content">
                <div class="recommend-info">
                    <p>每天为你推荐30首精选音乐</p>
                    <p class="recommend-date" id="recommendDate"></p>
                </div>
                <div class="recommend-actions">
                    <button class="recommend-refresh-btn" id="refreshRecommendBtn">
                        <i class="fas fa-sync-alt"></i> 刷新推荐
                    </button>
                    <button class="recommend-play-all-btn" id="playAllRecommendBtn">
                        <i class="fas fa-play"></i> 播放全部
                    </button>
                </div>
                <div class="recommend-songs" id="recommendSongs">
                    <div class="loading">加载中...</div>
                </div>
            </div>
        </div>

        <!-- 播放器区域 -->
        <div class="player-section">
            <div class="player-content">
                <div class="current-song">
                    <div class="current-cover-container">
                        <img class="current-cover" id="currentCover"
                             src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjIwIiBoZWlnaHQ9IjIyMCIgdmlld0JveD0iMCAwIDIyMCAyMjAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMjAiIGhlaWdodD0iMjIwIiBmaWxsPSJyZ2JhKDI1NSwyNTUsMjU5LDAuMSkiIHJ4PSIyMCIvPgo8cGF0aCBkPSJNMTEwIDcwTDE0MCAxMTBIMTIwVjE1MEg5MFYxMTBINzBMMTEwIDcwWiIgZmlsbD0icmdiYSgyNTUsMjU1LDI1NSwwLjMpIi8+Cjwvc3ZnPgo="
                             alt="专辑封面"
                             loading="eager">
                    </div>
                    <div class="current-info">
                        <h3 id="currentTitle">未选择歌曲</h3>
                        <p id="currentArtist">请搜索并选择要播放的歌曲</p>
                    </div>
                </div>
                <div class="player-controls">
                    <button class="control-btn small" id="playlistBtn" title="播放列表">
                        <i class="fas fa-list-ul"></i>
                    </button>
                    <button class="control-btn small" id="playerFavoriteBtn" title="添加到我的喜欢">
                        <i class="far fa-heart"></i>
                    </button>
                    <button class="control-btn small" id="prevBtn" title="上一首">
                        <i class="fas fa-step-backward"></i>
                    </button>
                    <button class="control-btn play-btn" id="playBtn">
                        <i class="fas fa-play"></i>
                    </button>
                    <button class="control-btn small" id="nextBtn" title="下一首">
                        <i class="fas fa-step-forward"></i>
                    </button>
                    <button class="control-btn small" id="playModeBtn" title="列表循环">
                        <i class="fas fa-repeat"></i>
                    </button>
                </div>
                <div class="lyrics-container-inline" id="lyricsContainerInline">
                    <div class="lyric-line lyric-prev"></div>
                    <div class="lyric-line lyric-current active">暂无歌词</div>
                    <div class="lyric-line lyric-next"></div>
                </div>
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="time-info">
                        <span id="currentTime">0:00</span>
                        <span id="totalTime">0:00</span>
                    </div>
                </div>
                <div class="volume-container">
                    <i class="fas fa-volume-up volume-icon"></i>
                    <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="80">
                </div>
                <div class="quality-download-container">
                    <select class="quality-select" id="qualitySelect">
                        <option value="128">标准 128K</option>
                        <option value="192">较高 192K</option>
                        <option value="320" selected>高品质 320K</option>
                    </select>
                    <button class="download-btn" id="downloadSongBtn" disabled>
                        <i class="fas fa-download"></i>
                        <span>下载音乐</span>
                    </button>
                    <button class="download-btn" id="downloadLyricBtn" disabled>
                        <i class="fas fa-file-text"></i>
                        <span>下载歌词</span>
                    </button>
                </div>
            </div>
            <audio id="audioPlayer" preload="metadata"></audio>
        </div>

        <!-- 播放统计区域 - 独立右侧栏 -->
        <div class="stats-section-sidebar">
            <div class="stats-header-inline">
                <h3><i class="fas fa-chart-bar"></i> 播放统计</h3>
            </div>
            <div class="stats-overview">
                <div class="stats-card">
                    <div class="stats-card-icon">🎵</div>
                    <div class="stats-card-info">
                        <div class="stats-card-value" id="totalPlaysCount">0</div>
                        <div class="stats-card-label">总播放次数</div>
                    </div>
                </div>
                <div class="stats-card">
                    <div class="stats-card-icon">🎧</div>
                    <div class="stats-card-info">
                        <div class="stats-card-value" id="uniqueSongsCount">0</div>
                        <div class="stats-card-label">不同歌曲</div>
                    </div>
                </div>
            </div>
            <div class="stats-tabs-inline">
                <button class="stats-tab active" data-stats-tab="most-played">最多播放</button>
                <button class="stats-tab" data-stats-tab="recent">最近播放</button>
            </div>
            <div class="stats-content-inline" id="statsContentInline">
                <div class="stats-tab-content active" id="mostPlayedContent">
                    <div class="stats-list" id="mostPlayedList">
                        <div class="stats-empty">暂无统计数据</div>
                    </div>
                </div>
                <div class="stats-tab-content" id="recentContent">
                    <div class="stats-list" id="recentList">
                        <div class="stats-empty">暂无统计数据</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="page-indicators">
            <button class="page-indicator active" data-page="0"></button>
            <button class="page-indicator" data-page="1"></button>
            <button class="page-indicator" data-page="2"></button>
        </div>
    </div>

    <!-- 播放列表弹窗 -->
    <div class="playlist-modal" id="playlistModal">
        <div class="playlist-modal-content">
            <div class="playlist-modal-header">
                <h3><i class="fas fa-list-ul"></i> 当前播放列表</h3>
                <button class="close-modal-btn" id="closePlaylistModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="playlist-modal-body" id="playlistModalBody">
                <div class="empty-state">
                    <i class="fas fa-music"></i>
                    <div>播放列表为空</div>
                </div>
            </div>
            <div class="playlist-modal-footer">
                <button class="modal-btn" id="clearPlaylistBtn">
                    <i class="fas fa-trash"></i> 清空列表
                </button>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-info">
                <p>© 2025 沄听 - 简洁在线音乐播放器</p>
                <p>
                    <a href="https://github.com/truelife0958/music888" target="_blank" rel="noopener noreferrer" class="github-link">
                        <i class="fab fa-github"></i> GitHub 仓库
                    </a>
                </p>
            </div>
        </div>
    </footer>

    <!-- 下载进度提示容器 -->
    <div class="download-progress-container" id="downloadProgressContainer"></div>

    <!-- 优化: 资源预加载提示 -->
    <link rel="preload" href="/css/style.css" as="style">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="https://music.163.com">
    
    <script type="module" src="js/main.ts"></script>
    <script>
        // 注册 Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        console.log('✅ Service Worker 注册成功');
                    })
                    .catch(error => {
                        console.error('❌ Service Worker 注册失败:', error);
                    });
            });
        }
    </script>
</body>
</html>
