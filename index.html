<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <!-- Content Security Policy (CSP) - 增强安全性 -->
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        script-src 'self' 'unsafe-inline';
        style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com;
        font-src 'self' https://cdnjs.cloudflare.com;
        img-src 'self' data: https: http:;
        media-src 'self' https: http: blob:;
        connect-src 'self' https: http:;
        worker-src 'self' blob:;
        manifest-src 'self';
        base-uri 'self';
        form-action 'self';
        frame-ancestors 'none';
        upgrade-insecure-requests;
    ">
    
    <title>沄听 - 在线音乐播放器</title>
    <meta name="description" content="简洁的在线音乐播放器">
    <meta name="theme-color" content="#1db954">
    <link rel="icon" type="image/x-icon" href="ytmusic.ico">
    <link rel="manifest" href="/manifest.json">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- 老王修复：添加实际的CSS样式表引入 -->
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div class="bg-animation"></div>
    <div class="bg-overlay"></div>
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <i class="fas fa-music"></i>
                <span>沄听</span>
            </div>
            <div class="search-container">
                <form class="search-wrapper">
                    <input type="text" class="search-input" placeholder="搜索音乐、歌手、专辑..." id="searchInput" required>
                    <select class="source-select" id="sourceSelect">
                        <option value="netease">网易云音乐</option>
                        <option value="tencent">QQ音乐</option>
                        <option value="kugou">酷狗音乐</option>
                        <option value="kuwo">酷我音乐</option>
                    </select>
                    <button type="submit" class="search-btn">
                        <i class="fas fa-search"></i>
                    </button>
                </form>
            </div>
        </div>
    </nav>
    
    <div class="main-container">
        <div class="content-section">
            <!-- 标签页：搜索结果、发现音乐、歌单 -->
            <div class="tabs">
                <button class="tab-btn active" data-tab="search">
                    <i class="fas fa-search"></i> 搜索结果
                </button>
                <button class="tab-btn" data-tab="discover">
                    <i class="fas fa-compass"></i> 发现音乐
                </button>
                <button class="tab-btn" data-tab="playlist">
                    <i class="fas fa-list-music"></i> 歌单
                </button>
            </div>

            <!-- 搜索结果标签页 - 包含每日推荐和刷新推荐 -->
            <div id="searchTab" class="tab-content active">
                <!-- 每日推荐和刷新按钮 -->
                <div class="daily-recommend-section">
                    <button class="daily-recommend-btn" id="dailyRecommendBtn">
                        <i class="fas fa-calendar-day"></i> 每日推荐
                    </button>
                    <button class="refresh-recommend-btn" id="refreshRecommendBtn">
                        <i class="fas fa-sync-alt"></i> 刷新推荐
                    </button>
                </div>
                <!-- 搜索结果显示区域 -->
                <div class="search-results" id="searchResults">
                    <div class="empty-state">
                        <i class="fas fa-search"></i>
                        <div>在上方搜索框输入关键词搜索音乐</div>
                    </div>
                </div>
            </div>

            <!-- 发现音乐标签页 - 歌手分类 -->
            <div id="discoverTab" class="tab-content">
                <!-- 歌手分类内容 -->
                <div id="artistContent" class="discover-content active">
                    <div class="artist-filters">
                        <div class="filter-group">
                            <label>类型:</label>
                            <select class="artist-type-select" id="artistTypeSelect">
                                <option value="-1">全部</option>
                                <option value="1">男歌手</option>
                                <option value="2">女歌手</option>
                                <option value="3">乐队</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>地区:</label>
                            <select class="artist-area-select" id="artistAreaSelect">
                                <option value="-1">全部</option>
                                <option value="7">华语</option>
                                <option value="96">欧美</option>
                                <option value="8">日本</option>
                                <option value="16">韩国</option>
                                <option value="0">其他</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>首字母:</label>
                            <select class="artist-initial-select" id="artistInitialSelect">
                                <option value="-1">热门</option>
                                <option value="0">#</option>
                                <option value="a">A</option>
                                <option value="b">B</option>
                                <option value="c">C</option>
                                <option value="d">D</option>
                                <option value="e">E</option>
                                <option value="f">F</option>
                                <option value="g">G</option>
                                <option value="h">H</option>
                                <option value="i">I</option>
                                <option value="j">J</option>
                                <option value="k">K</option>
                                <option value="l">L</option>
                                <option value="m">M</option>
                                <option value="n">N</option>
                                <option value="o">O</option>
                                <option value="p">P</option>
                                <option value="q">Q</option>
                                <option value="r">R</option>
                                <option value="s">S</option>
                                <option value="t">T</option>
                                <option value="u">U</option>
                                <option value="v">V</option>
                                <option value="w">W</option>
                                <option value="x">X</option>
                                <option value="y">Y</option>
                                <option value="z">Z</option>
                            </select>
                        </div>
                    </div>
                    <div class="artist-list" id="artistList"></div>
                </div>
            </div>

            <!-- 歌单标签页 -->
            <div id="playlistTab" class="tab-content">
                <!-- 歌单解析输入区 -->
                <div class="playlist-input-container">
                    <select class="playlist-source-select" id="playlistSourceSelect">
                        <option value="netease">网易云音乐</option>
                        <option value="tencent">QQ音乐</option>
                    </select>
                    <input type="text" id="playlistIdInput" class="playlist-input" placeholder="输入歌单ID (如: 60198) 或链接...">
                    <button class="playlist-btn">
                        <i class="fas fa-download"></i> 解析歌单
                    </button>
                </div>

                <!-- 网易热门歌单推荐 -->
                <div class="hot-playlists-section" id="hotPlaylistsSection">
                    <h4 style="color: rgba(255,255,255,0.9); font-size: 16px; margin: 20px 0 15px 0; padding-left: 10px; border-left: 3px solid #ff6b6b;">
                        <i class="fas fa-fire"></i> 网易热门歌单
                    </h4>
                    <div class="hot-playlists-controls">
                        <select class="playlist-order-select" id="playlistOrderSelect">
                            <option value="hot">最热</option>
                            <option value="new">最新</option>
                        </select>
                        <select class="playlist-category-select" id="playlistCategorySelect">
                            <option value="全部">全部</option>
                            <option value="华语">华语</option>
                            <option value="古风">古风</option>
                            <option value="欧美">欧美</option>
                            <option value="流行">流行</option>
                            <option value="摇滚">摇滚</option>
                            <option value="民谣">民谣</option>
                            <option value="电子">电子</option>
                            <option value="说唱">说唱</option>
                            <option value="轻音乐">轻音乐</option>
                            <option value="影视原声">影视原声</option>
                            <option value="ACG">ACG</option>
                            <option value="怀旧">怀旧</option>
                        </select>
                        <button class="refresh-playlists-btn" id="refreshPlaylistsBtn">
                            <i class="fas fa-sync-alt"></i> 刷新
                        </button>
                    </div>
                    <div class="hot-playlists-grid" id="hotPlaylistsGrid">
                        <div class="loading">
                            <i class="fas fa-spinner"></i>
                            <div>正在加载热门歌单...</div>
                        </div>
                    </div>
                </div>

                <!-- 网友精选碟 -->
                <div class="user-playlists-section" id="userPlaylistsSection">
                    <h4 style="color: rgba(255,255,255,0.9); font-size: 16px; margin: 20px 0 15px 0; padding-left: 10px; border-left: 3px solid #4ecdc4;">
                        <i class="fas fa-star"></i> 网友精选碟
                    </h4>
                    <div class="user-playlists-controls">
                        <select class="user-playlists-order-select" id="userPlaylistsOrderSelect">
                            <option value="hot">最热</option>
                            <option value="new">最新</option>
                        </select>
                        <select class="user-playlists-category-select" id="userPlaylistsCategorySelect">
                            <option value="全部">全部</option>
                            <option value="华语">华语</option>
                            <option value="古风">古风</option>
                            <option value="欧美">欧美</option>
                            <option value="流行">流行</option>
                            <option value="摇滚">摇滚</option>
                            <option value="民谣">民谣</option>
                            <option value="电子">电子</option>
                            <option value="说唱">说唱</option>
                            <option value="轻音乐">轻音乐</option>
                            <option value="影视原声">影视原声</option>
                            <option value="ACG">ACG</option>
                            <option value="怀旧">怀旧</option>
                        </select>
                        <button class="refresh-user-playlists-btn" id="refreshUserPlaylistsBtn">
                            <i class="fas fa-sync-alt"></i> 刷新
                        </button>
                    </div>
                    <div class="user-playlists-grid" id="userPlaylistsGrid">
                        <div class="loading">
                            <i class="fas fa-spinner"></i>
                            <div>正在加载网友精选碟...</div>
                        </div>
                    </div>
                </div>

                <!-- 解析结果显示区 -->
                <div class="search-results" id="parseResults" style="display: none;">
                    <!-- 解析结果将显示在这里 -->
                </div>
            </div>
        </div>

        <!-- 播放器区域 -->
        <div class="player-section">
            <div class="player-content">
                <div class="current-song">
                    <div class="current-cover-container">
                        <img class="current-cover" id="currentCover"
                             src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjIwIiBoZWlnaHQ9IjIyMCIgdmlld0JveD0iMCAwIDIyMCAyMjAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMjAiIGhlaWdodD0iMjIwIiBmaWxsPSJyZ2JhKDI1NSwyNTUsMjU5LDAuMSkiIHJ4PSIyMCIvPgo8cGF0aCBkPSJNMTEwIDcwTDE0MCAxMTBIMTIwVjE1MEg5MFYxMTBINzBMMTEwIDcwWiIgZmlsbD0icmdiYSgyNTUsMjU1LDI1NSwwLjMpIi8+Cjwvc3ZnPgo="
                             alt="专辑封面"
                             loading="eager">
                    </div>
                    <div class="current-info">
                        <h3 id="currentTitle">未选择歌曲</h3>
                        <p id="currentArtist">请搜索并选择要播放的歌曲</p>
                    </div>
                </div>
                <div class="player-controls">
                    <button class="control-btn small" id="playlistBtn" title="播放列表">
                        <i class="fas fa-list-ul"></i>
                    </button>
                    <button class="control-btn small" id="prevBtn" title="上一首">
                        <i class="fas fa-step-backward"></i>
                    </button>
                    <button class="control-btn play-btn" id="playBtn">
                        <i class="fas fa-play"></i>
                    </button>
                    <button class="control-btn small" id="nextBtn" title="下一首">
                        <i class="fas fa-step-forward"></i>
                    </button>
                    <button class="control-btn small" id="playModeBtn" title="列表循环">
                        <i class="fas fa-repeat"></i>
                    </button>
                </div>
                <div class="lyrics-container-inline" id="lyricsContainerInline">
                    <div class="lyrics-header-inline">
                        <button class="lyrics-download-btn" id="lyricsDownloadBtn" disabled title="下载当前歌词">
                            <i class="fas fa-download"></i>
                            <span>下载歌词</span>
                        </button>
                    </div>
                    <div class="lyric-line lyric-prev"></div>
                    <div class="lyric-line lyric-current active">暂无歌词</div>
                    <div class="lyric-line lyric-next"></div>
                </div>
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="time-info">
                        <span id="currentTime">0:00</span>
                        <span id="totalTime">0:00</span>
                    </div>
                </div>
                <div class="volume-container">
                    <i class="fas fa-volume-up volume-icon"></i>
                    <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="80">
                </div>
                <div class="quality-control-container">
                    <button class="quality-toggle-btn" id="qualityToggleBtn" title="点击切换音质">
                        <i class="fas fa-music"></i>
                        <span id="qualityText">高品质 320K</span>
                    </button>
                </div>
            </div>
            <audio id="audioPlayer" preload="metadata"></audio>
        </div>

        <!-- 播放统计区域 - 独立右侧栏 -->
        <div class="stats-section-sidebar">
            <div class="stats-header-inline">
                <h3><i class="fas fa-chart-bar"></i> 播放统计</h3>
            </div>
            <div class="stats-tabs-inline">
                <button class="stats-tab active" data-stats-tab="history">播放历史</button>
                <button class="stats-tab" data-stats-tab="favorites">收藏列表</button>
            </div>
            <div class="stats-content-inline" id="statsContentInline">
                <div class="stats-tab-content active" id="historyContent">
                    <div class="stats-list" id="historyList">
                        <div class="stats-empty">暂无播放历史</div>
                    </div>
                </div>
                <div class="stats-tab-content" id="favoritesContent">
                    <div class="stats-list" id="favoritesList">
                        <div class="stats-empty">暂无收藏</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="page-indicators">
            <button class="page-indicator active" data-page="0"></button>
            <button class="page-indicator" data-page="1"></button>
            <button class="page-indicator" data-page="2"></button>
        </div>
    </div>

    <!-- 播放列表弹窗 -->
    <div class="playlist-modal" id="playlistModal">
        <div class="playlist-modal-content">
            <div class="playlist-modal-header">
                <h3><i class="fas fa-list-ul"></i> 当前播放列表</h3>
                <button class="close-modal-btn" id="closePlaylistModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="playlist-modal-body" id="playlistModalBody">
                <div class="empty-state">
                    <i class="fas fa-music"></i>
                    <div>播放列表为空</div>
                </div>
            </div>
            <div class="playlist-modal-footer">
                <button class="modal-btn" id="clearPlaylistBtn">
                    <i class="fas fa-trash"></i> 清空列表
                </button>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-info">
                <p>© 2025 沄听 - 简洁在线音乐播放器</p>
                <p>
                    <a href="https://github.com/truelife0958/music888" target="_blank" rel="noopener noreferrer" class="github-link">
                        <i class="fab fa-github"></i> GitHub 仓库
                    </a>
                </p>
            </div>
        </div>
    </footer>

    <!-- 下载进度提示容器 -->
    <div class="download-progress-container" id="downloadProgressContainer"></div>

    <!-- 优化: 资源预加载提示 -->
    <link rel="preload" href="/css/style.css" as="style">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="https://music.163.com">
    
    <script type="module" src="js/main.ts"></script>
    <script>
        // 注册 Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        console.log('✅ Service Worker 注册成功');
                    })
                    .catch(error => {
                        console.error('❌ Service Worker 注册失败:', error);
                    });
            });
        }
    </script>
</body>
</html>
