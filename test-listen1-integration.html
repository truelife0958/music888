<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Listen1 å¤šå¹³å°æœç´¢æµ‹è¯• - Music888</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
      color: #333;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      padding: 40px;
    }

    h1 {
      text-align: center;
      color: #667eea;
      margin-bottom: 10px;
      font-size: 2.5em;
    }

    .subtitle {
      text-align: center;
      color: #666;
      margin-bottom: 30px;
      font-size: 1.1em;
    }

    .test-section {
      margin-bottom: 30px;
      padding: 25px;
      background: #f8f9fa;
      border-radius: 15px;
      border-left: 5px solid #667eea;
    }

    .test-section h2 {
      color: #667eea;
      margin-bottom: 15px;
      font-size: 1.5em;
    }

    .search-box {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .search-box input {
      flex: 1;
      padding: 12px 20px;
      border: 2px solid #ddd;
      border-radius: 10px;
      font-size: 16px;
      transition: all 0.3s;
    }

    .search-box input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .btn {
      padding: 12px 30px;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
    }

    .btn-secondary {
      background: #6c757d;
      color: white;
    }

    .btn-secondary:hover {
      background: #5a6268;
    }

    .status {
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 15px;
      font-weight: 500;
    }

    .status.info {
      background: #d1ecf1;
      color: #0c5460;
      border-left: 4px solid #17a2b8;
    }

    .status.success {
      background: #d4edda;
      color: #155724;
      border-left: 4px solid #28a745;
    }

    .status.error {
      background: #f8d7da;
      color: #721c24;
      border-left: 4px solid #dc3545;
    }

    .status.warning {
      background: #fff3cd;
      color: #856404;
      border-left: 4px solid #ffc107;
    }

    .results {
      max-height: 500px;
      overflow-y: auto;
      background: white;
      border-radius: 10px;
      padding: 15px;
      border: 2px solid #e9ecef;
    }

    .result-item {
      padding: 15px;
      border-bottom: 1px solid #e9ecef;
      transition: background 0.2s;
    }

    .result-item:hover {
      background: #f8f9fa;
    }

    .result-item:last-child {
      border-bottom: none;
    }

    .result-item h4 {
      color: #333;
      margin-bottom: 8px;
      font-size: 1.1em;
    }

    .result-item p {
      color: #666;
      font-size: 0.95em;
      margin-bottom: 5px;
    }

    .platform-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 15px;
      font-size: 0.85em;
      font-weight: 600;
      margin-right: 8px;
    }

    .platform-netease { background: #d33a31; color: white; }
    .platform-qq { background: #31c27c; color: white; }
    .platform-kugou { background: #2ca2f9; color: white; }
    .platform-kuwo { background: #ff6600; color: white; }
    .platform-migu { background: #ff6d00; color: white; }

    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }

    .stat-card {
      background: white;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      border: 2px solid #e9ecef;
    }

    .stat-card h3 {
      color: #667eea;
      font-size: 2em;
      margin-bottom: 5px;
    }

    .stat-card p {
      color: #666;
      font-size: 0.95em;
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: #667eea;
      font-size: 1.2em;
    }

    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #667eea;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸµ Listen1 å¤šå¹³å°æœç´¢æµ‹è¯•</h1>
    <p class="subtitle">æµ‹è¯•ç½‘æ˜“äº‘ã€QQéŸ³ä¹ã€é…·ç‹—ã€é…·æˆ‘ã€å’ªå’•éŸ³ä¹èšåˆæœç´¢åŠŸèƒ½</p>

    <!-- æµ‹è¯•1ï¼šç³»ç»ŸçŠ¶æ€æ£€æŸ¥ -->
    <div class="test-section">
      <h2>ğŸ“Š æµ‹è¯•1ï¼šç³»ç»ŸçŠ¶æ€æ£€æŸ¥</h2>
      <button class="btn btn-primary" onclick="testSystemStatus()">è¿è¡Œæµ‹è¯•</button>
      <div id="status-result"></div>
    </div>

    <!-- æµ‹è¯•2ï¼šå¤šå¹³å°æœç´¢ -->
    <div class="test-section">
      <h2>ğŸ” æµ‹è¯•2ï¼šå¤šå¹³å°èšåˆæœç´¢</h2>
      <div class="search-box">
        <input type="text" id="search-keyword" placeholder="è¾“å…¥æ­Œæ›²åæˆ–æ­Œæ‰‹å..." value="å‘¨æ°ä¼¦">
        <button class="btn btn-primary" onclick="testMultiPlatformSearch()">æœç´¢</button>
      </div>
      <div id="search-result"></div>
    </div>

    <!-- æµ‹è¯•3ï¼šå•å¹³å°æœç´¢ -->
    <div class="test-section">
      <h2>ğŸ¯ æµ‹è¯•3ï¼šå•å¹³å°æœç´¢æµ‹è¯•</h2>
      <div class="search-box">
        <input type="text" id="single-search-keyword" placeholder="è¾“å…¥æ­Œæ›²åæˆ–æ­Œæ‰‹å..." value="æ™´å¤©">
        <select id="platform-select" style="padding: 12px; border-radius: 10px; border: 2px solid #ddd; font-size: 16px;">
          <option value="netease">ç½‘æ˜“äº‘éŸ³ä¹</option>
          <option value="qq">QQéŸ³ä¹</option>
          <option value="kugou">é…·ç‹—éŸ³ä¹</option>
          <option value="kuwo">é…·æˆ‘éŸ³ä¹</option>
          <option value="migu">å’ªå’•éŸ³ä¹</option>
        </select>
        <button class="btn btn-primary" onclick="testSinglePlatformSearch()">æœç´¢</button>
      </div>
      <div id="single-search-result"></div>
    </div>

    <!-- æµ‹è¯•4ï¼šæ’­æ”¾URLè·å– -->
    <div class="test-section">
      <h2>ğŸµ æµ‹è¯•4ï¼šæ’­æ”¾URLè·å–æµ‹è¯•</h2>
      <p class="status info">å…ˆè¿›è¡Œæœç´¢ï¼Œç„¶åç‚¹å‡»ç»“æœä¸­çš„"è·å–æ’­æ”¾URL"æŒ‰é’®</p>
      <div id="playurl-result"></div>
    </div>
  </div>

  <script type="module">
    import { unifiedProviderManager } from './js/providers/unified-provider-manager.js';
    import { loWeb } from './js/providers/listen1-media-service.js';

    // æš´éœ²åˆ°å…¨å±€ä½œç”¨åŸŸä¾›æŒ‰é’®è°ƒç”¨
    window.unifiedProviderManager = unifiedProviderManager;
    window.loWeb = loWeb;

    // æµ‹è¯•1ï¼šç³»ç»ŸçŠ¶æ€æ£€æŸ¥
    window.testSystemStatus = async function() {
      const resultDiv = document.getElementById('status-result');
      resultDiv.innerHTML = '<div class="loading"><div class="spinner"></div>æ£€æŸ¥ç³»ç»ŸçŠ¶æ€...</div>';

      try {
        // è·å–ç³»ç»ŸçŠ¶æ€
        const systemStatus = unifiedProviderManager.getSystemStatus();
        const platforms = unifiedProviderManager.getAllPlatforms();

        let html = '<div class="status success">âœ… ç³»ç»ŸçŠ¶æ€æ£€æŸ¥æˆåŠŸ</div>';
        html += '<div class="stats">';
        html += `<div class="stat-card"><h3>${platforms.length}</h3><p>æ”¯æŒçš„å¹³å°</p></div>`;
        html += `<div class="stat-card"><h3>${systemStatus.listen1 ? 'âœ…' : 'âŒ'}</h3><p>Listen1æ¶æ„</p></div>`;
        html += `<div class="stat-card"><h3>${systemStatus.enhanced ? 'âœ…' : 'âŒ'}</h3><p>Enhancedæ¶æ„</p></div>`;
        html += `<div class="stat-card"><h3>${systemStatus.original ? 'âœ…' : 'âŒ'}</h3><p>Originalæ¶æ„</p></div>`;
        html += '</div>';

        html += '<div style="margin-top: 20px;"><strong>æ”¯æŒçš„å¹³å°åˆ—è¡¨ï¼š</strong></div>';
        html += '<div class="results">';
        platforms.forEach(p => {
          const badgeClass = `platform-${p.id}`;
          html += `<div class="result-item">`;
          html += `<span class="platform-badge ${badgeClass}">${p.name}</span>`;
          html += `<span style="color: #999;">æ¥æº: ${p.source}</span>`;
          html += `</div>`;
        });
        html += '</div>';

        resultDiv.innerHTML = html;
      } catch (error) {
        resultDiv.innerHTML = `<div class="status error">âŒ æµ‹è¯•å¤±è´¥: ${error.message}</div>`;
        console.error('ç³»ç»ŸçŠ¶æ€æ£€æŸ¥å¤±è´¥:', error);
      }
    };

    // æµ‹è¯•2ï¼šå¤šå¹³å°æœç´¢
    window.testMultiPlatformSearch = async function() {
      const keyword = document.getElementById('search-keyword').value;
      const resultDiv = document.getElementById('search-result');

      if (!keyword) {
        resultDiv.innerHTML = '<div class="status warning">âš ï¸ è¯·è¾“å…¥æœç´¢å…³é”®è¯</div>';
        return;
      }

      resultDiv.innerHTML = '<div class="loading"><div class="spinner"></div>æ­£åœ¨ä»5ä¸ªå¹³å°èšåˆæœç´¢...</div>';

      try {
        const startTime = Date.now();

        // ä½¿ç”¨unifiedProviderManagerçš„allmusicæœç´¢ï¼ˆèšåˆæ‰€æœ‰å¹³å°ï¼‰
        const result = await unifiedProviderManager.search(keyword, 'allmusic', { limit: 20 });

        const duration = ((Date.now() - startTime) / 1000).toFixed(2);

        let html = `<div class="status success">âœ… æœç´¢æˆåŠŸï¼ç”¨æ—¶ ${duration}ç§’</div>`;
        html += '<div class="stats">';
        html += `<div class="stat-card"><h3>${result.songs.length}</h3><p>æ‰¾åˆ°æ­Œæ›²</p></div>`;
        html += `<div class="stat-card"><h3>${result.total}</h3><p>æ€»ç»“æœæ•°</p></div>`;
        html += `<div class="stat-card"><h3>${duration}s</h3><p>æœç´¢è€—æ—¶</p></div>`;
        html += '</div>';

        html += '<div style="margin-top: 20px;"><strong>æœç´¢ç»“æœï¼š</strong></div>';
        html += '<div class="results">';

        result.songs.forEach((song, index) => {
          const badgeClass = `platform-${song.source}`;
          html += `<div class="result-item">`;
          html += `<h4>${index + 1}. ${song.name}</h4>`;
          html += `<p>è‰ºæœ¯å®¶: ${Array.isArray(song.artist) ? song.artist.join(', ') : song.artist}</p>`;
          html += `<p>ä¸“è¾‘: ${song.album || 'æœªçŸ¥'}</p>`;
          html += `<p><span class="platform-badge ${badgeClass}">${song.source}</span>`;
          html += `<button class="btn btn-secondary" style="padding: 5px 15px; font-size: 14px;" onclick="testGetPlayUrl('${song.id}', '${song.name}', '${song.source}')">è·å–æ’­æ”¾URL</button></p>`;
          html += `</div>`;
        });

        html += '</div>';
        resultDiv.innerHTML = html;
      } catch (error) {
        resultDiv.innerHTML = `<div class="status error">âŒ æœç´¢å¤±è´¥: ${error.message}</div>`;
        console.error('æœç´¢å¤±è´¥:', error);
      }
    };

    // æµ‹è¯•3ï¼šå•å¹³å°æœç´¢
    window.testSinglePlatformSearch = async function() {
      const keyword = document.getElementById('single-search-keyword').value;
      const platform = document.getElementById('platform-select').value;
      const resultDiv = document.getElementById('single-search-result');

      if (!keyword) {
        resultDiv.innerHTML = '<div class="status warning">âš ï¸ è¯·è¾“å…¥æœç´¢å…³é”®è¯</div>';
        return;
      }

      resultDiv.innerHTML = `<div class="loading"><div class="spinner"></div>æ­£åœ¨ä»${platform}æœç´¢...</div>`;

      try {
        const startTime = Date.now();

        // ä½¿ç”¨æŒ‡å®šå¹³å°æœç´¢
        const result = await unifiedProviderManager.search(keyword, platform, { limit: 20 });

        const duration = ((Date.now() - startTime) / 1000).toFixed(2);

        let html = `<div class="status success">âœ… ${platform} æœç´¢æˆåŠŸï¼ç”¨æ—¶ ${duration}ç§’</div>`;
        html += '<div class="stats">';
        html += `<div class="stat-card"><h3>${result.songs.length}</h3><p>æ‰¾åˆ°æ­Œæ›²</p></div>`;
        html += `<div class="stat-card"><h3>${duration}s</h3><p>æœç´¢è€—æ—¶</p></div>`;
        html += '</div>';

        html += '<div style="margin-top: 20px;"><strong>æœç´¢ç»“æœï¼š</strong></div>';
        html += '<div class="results">';

        result.songs.forEach((song, index) => {
          html += `<div class="result-item">`;
          html += `<h4>${index + 1}. ${song.name}</h4>`;
          html += `<p>è‰ºæœ¯å®¶: ${Array.isArray(song.artist) ? song.artist.join(', ') : song.artist}</p>`;
          html += `<p>ä¸“è¾‘: ${song.album || 'æœªçŸ¥'}</p>`;
          html += `</div>`;
        });

        html += '</div>';
        resultDiv.innerHTML = html;
      } catch (error) {
        resultDiv.innerHTML = `<div class="status error">âŒ æœç´¢å¤±è´¥: ${error.message}</div>`;
        console.error('æœç´¢å¤±è´¥:', error);
      }
    };

    // æµ‹è¯•4ï¼šè·å–æ’­æ”¾URL
    window.testGetPlayUrl = async function(songId, songName, source) {
      const resultDiv = document.getElementById('playurl-result');
      resultDiv.innerHTML = `<div class="loading"><div class="spinner"></div>æ­£åœ¨è·å–ã€Š${songName}ã€‹çš„æ’­æ”¾URL...</div>`;

      try {
        const song = {
          id: songId,
          name: songName,
          artist: [],
          album: '',
          source: source,
          url: '',
        };

        const result = await unifiedProviderManager.getPlayUrl(song, '320k');

        if (result.url) {
          let html = `<div class="status success">âœ… æ’­æ”¾URLè·å–æˆåŠŸï¼</div>`;
          html += '<div class="results">';
          html += `<div class="result-item">`;
          html += `<h4>æ­Œæ›²: ${songName}</h4>`;
          html += `<p>ç ç‡: ${result.br}</p>`;
          html += `<p>æ¥æº: ${result.fromSource || source}</p>`;
          html += `<p>URL: <a href="${result.url}" target="_blank" style="color: #667eea; word-break: break-all;">${result.url}</a></p>`;
          html += `<audio controls src="${result.url}" style="width: 100%; margin-top: 10px;"></audio>`;
          html += `</div>`;
          html += '</div>';
          resultDiv.innerHTML = html;
        } else {
          resultDiv.innerHTML = '<div class="status error">âŒ æ— æ³•è·å–æ’­æ”¾URL</div>';
        }
      } catch (error) {
        resultDiv.innerHTML = `<div class="status error">âŒ è·å–å¤±è´¥: ${error.message}</div>`;
        console.error('è·å–æ’­æ”¾URLå¤±è´¥:', error);
      }
    };

    // é¡µé¢åŠ è½½åè‡ªåŠ¨è¿è¡Œç³»ç»ŸçŠ¶æ€æ£€æŸ¥
    window.addEventListener('load', () => {
      console.log('ğŸµ Listen1 å¤šå¹³å°æœç´¢æµ‹è¯•é¡µé¢å·²åŠ è½½');
      console.log('ğŸ“Š å¯ç”¨æµ‹è¯•:', {
        testSystemStatus: 'ç³»ç»ŸçŠ¶æ€æ£€æŸ¥',
        testMultiPlatformSearch: 'å¤šå¹³å°èšåˆæœç´¢',
        testSinglePlatformSearch: 'å•å¹³å°æœç´¢',
        testGetPlayUrl: 'æ’­æ”¾URLè·å–'
      });
    });
  </script>
</body>
</html>
