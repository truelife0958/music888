
# Music888 组件使用指南

## 目录
- [快速开始](#快速开始)
- [播放器组件](#播放器组件)
- [搜索组件](#搜索组件)
- [播放列表组件](#播放列表组件)
- [歌词组件](#歌词组件)
- [主题系统](#主题系统)
- [完整示例](#完整示例)

---

## 快速开始

### 基础引入

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Music888</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div id="app"></div>
  <script type="module" src="js/main.ts"></script>
</body>
</html>
```

### 基本用法

```typescript
import { playSong, searchSongs } from './js/player';

// 搜索并播放
const results = await searchSongs('周杰伦');
if (results.songs.length > 0) {
  await playSong(results.songs[0]);
}
```

---

## 播放器组件

### HTML 结构

```html
<div class="player-container">
  <!-- 播放器信息 -->
  <div class="player-info">
    <img id="player-cover" class="player-cover" src="default-cover.jpg" alt="封面">
    <div class="player-details">
      <div id="player-song-name" class="player-song-name">歌曲名</div>
      <div id="player-artist" class="player-artist">艺术家</div>
    </div>
  </div>

  <!-- 播放控制 -->
  <div class="player-controls">
    <button id="prev-btn" class="control-btn">
      <i class="fas fa-step-backward"></i>
    </button>
    <button id="play-pause-btn" class="control-btn play-btn">
      <i class="fas fa-play"></i>
    </button>
    <button id="next-btn" class="control-btn">
      <i class="fas fa-step-forward"></i>
    </button>
  </div>

  <!-- 进度条 -->
  <div class="progress-container">
    <span id="current-time" class="time">0:00</span>
    <div id="progress-bar" class="progress-bar">
      <div id="progress-fill" class="progress-fill"></div>
    </div>
    <span id="duration" class="time">0:00</span>
  </div>
</div>
```

### JavaScript 控制

```typescript
import { playSong, togglePlay, nextSong, previousSong, seek } from './js/player';

// 播放歌曲
await playSong({
  id: '123',
  name: '晴天',
  artist: '周杰伦',
  source: 'netease'
});

// 播放/暂停
document.getElementById('play-pause-btn')?.addEventListener('click', () => {
  togglePlay();
});

// 上一首
document.getElementById('prev-btn')?.addEventListener('click', async () => {
  await previousSong();
});

// 下一首
document.getElementById('next-btn')?.addEventListener('click', async () => {
  await nextSong();
});

// 进度条拖动
const progressBar = document.getElementById('progress-bar');
progressBar?.addEventListener('click', (e) => {
  const rect = progressBar.getBoundingClientRect();
  const percent = (e.clientX - rect.left) / rect.width;
  const audio = document.getElementById('audio') as HTMLAudioElement;
  seek(audio.duration * percent);
});
```

### 样式自定义

```css
/* 自定义播放器颜色 */
.player-container {
  --primary-color: #1db954;
  --hover-color: #1ed760;
  background: var(--player-bg);
  border-radius: 12px;
  padding: 20px;
}

/* 自定义按钮 */
.control-btn {
  background: transparent;
  border: none;
  color: var(--text-primary);
  cursor: pointer;
  font-size: 24px;
  padding: 10px;
  transition: all 0.2s;
}

.control-btn:hover {
  color: var(--primary-color);
  transform: scale(1.1);
}

/* 自定义进度条 */
.progress-bar {
  height: 4px;
  background: var(--progress-bg);
  border-radius: 2px;
  cursor: pointer;
  overflow: hidden;
}

.progress-fill {
  height: 100%;
  background: var(--primary-color);
  transition: width 0.1s linear;
}
```

---

## 搜索组件

### HTML 结构

```html
<div class="search-container">
  <input 
    type="text" 
    id="search-input" 
    class="search-input" 
    placeholder="搜索歌曲、艺术家..."
  >
  <button id="search-btn" class="search-btn">
    <i class="fas fa-search"></i>
  </button>
  
  <!-- 音乐源选择 -->
  <select id="source-select" class="source-select">
    <option value="netease">网易云音乐</option>
    <option value="tencent">QQ音乐</option>
    <option value="kugou">酷狗音乐</option>
  </select>
</div>

<!-- 搜索结果 -->
<div id="search-results" class="search-results"></div>
```

### JavaScript 实现

```typescript
import { searchSongs } from './js/api';
import { displaySearchResults } from './js/ui';
import { debounce } from './js/utils';

const searchInput = document.getElementById('search-input') as HTMLInputElement;
const sourceSelect = document.getElementById('source-select') as HTMLSelectElement;

// 防抖搜索
const debouncedSearch = debounce(async (keyword: string) => {
  if (keyword.trim().length === 0) return;
  
  const source = sourceSelect.value;
  const results = await searchSongs(keyword, source);
  displaySearchResults(results.songs);
}, 300);

// 绑定事件
searchInput.addEventListener('input', (e) => {
  debouncedSearch((e.target as HTMLInputElement).value);
});

// 回车搜索
searchInput.addEventListener('keypress', (e) => {
  if (e.key === 'Enter') {
    const keyword = searchInput.value;
    searchSongs(keyword, sourceSelect.value).then(results => {
      displaySearchResults(results.songs);
    });
  }
});
```

### 搜索结果渲染

```typescript
function renderSearchResult(song: Song): string {
  return `
    <div class="song-item" data-song-id="${song.id}">
      <img src="${song.cover || 'default-cover.jpg'}" alt="${song.name}" class="song-cover">
      <div class="song-info">
        <div class="song-name">${song.name}</div>
        <div class="song-artist">${formatArtist(song.artist)}</div>
      </div>
      <div class="song-actions">
        <button class="btn-play" title="播放">
          <i class="fas fa-play"></i>
        </button>
        <button class="btn-favorite" title="收藏">
          <i class="far fa-heart"></i>
        </button>
        <button class="btn-download" title="下载">
          <i class="fas fa-download"></i>
        </button>
      </div>
    </div>
  `;
}
```

---

## 播放列表组件

### 创建播放列表

```typescript
import { createPlaylist, addToPlaylist, getPlaylists } from './js/playlist';

// 创建新播放列表
const playlist = await createPlaylist({
  name: '我的歌单',
  description: '喜欢的歌曲',
  songs: []
});

// 添加歌曲到播放列表
await addToPlaylist(playlist.id, song);

// 获取所有播放列表
const playlists = await getPlaylists();
```

### 播放列表UI

```html
<div class="playlist-container">
  <div class="playlist-header">
    <h3>播放列表</h3>
    <button id="create-playlist-btn" class="btn-create">
      <i class="fas fa-plus"></i> 新建歌单
    </button>
  </div>
  
  <div id="playlist-list" class="playlist-list">
    <!-- 播放列表项 -->
  </div>
</div>
```

### 渲染播放列表

```typescript
function renderPlaylist(playlist: Playlist): string {
  return `
    <div class="playlist-item" data-playlist-id="${playlist.id}">
      <div class="playlist-cover">
        <img src="${playlist.cover || 'default-playlist.jpg'}" alt="${playlist.name}">
        <div class="playlist-overlay">
          <button class="btn-play-all">
            <i class="fas fa-play"></i>
          </button>
        </div>
      </div>
      <div class="playlist-info">
        <div class="playlist-name">${playlist.name}</div>
        <div class="playlist-count">${playlist.songs.length} 首歌曲</div>
      </div>
      <div class="playlist-actions">
        <button class="btn-edit" title="编辑">
          <i class="fas fa-edit"></i>
        </button>
        <button class="btn-delete" title="删除">
          <i class="fas fa-trash"></i>
        </button>
      </div>
    </div>
  `;
}
```

---

## 歌词组件

### HTML 结构

```html
<div class="lyrics-container">
  <!-- 三行歌词模式 -->
  <div class="lyrics-three-line">
    <div class="lyric-line lyric-prev"></div>
    <div class="lyric-line lyric-current"></div>
    <div class="lyric-line lyric-next"></div>
  </div>
  
  <!-- 滚动歌词模式 -->
  <div class="lyrics-scroll" style="display: none;">
    <div id="lyrics-content" class="lyrics-content"></div>
  </div>
  
  <!-- 切换按钮 -->
  <button id="lyrics-mode-toggle" class="lyrics-toggle">
    <i class="fas fa-exchange-alt"></i>
  </button>
</div>
```

### JavaScript 控制

```typescript
import { getLyrics } from './js/api';
import { updateLyrics } from './js/ui';

// 获取并显示歌词
async function loadLyrics(songId: string, source: string) {
  const lyrics = await getLyrics(songId, source);
  
  // 监听音频时间更新
  const audio = document.getElementById('audio') as HTMLAudioElement;
  audio.addEventListener('timeupdate', () => {
    updateLyrics(lyrics, audio.currentTime);
  });
}

// 切换歌词显示模式
const lyricsToggle = document.getElementById('lyrics-mode-toggle');
const threeLineMode = document.querySelector('.lyrics-three-line');
const scrollMode = document.querySelector('.lyrics-scroll');

lyricsToggle?.addEventListener('click', () => {
  const isThreeLineVisible = threeLineMode?.style.display !== 'none';
  
  if (isThreeLineVisible) {
    threeLineMode.style.display = 'none';
    scrollMode.style.display = 'block';
  } else {
    threeLineMode.style.display = 'block';
    scrollMode.style.display = 'none';
  }
});
```

### 歌词高亮效果

```css
.lyric-line {
  text-align: center;
  transition: all 0.3s ease;
  padding: 8px 0;
}

.lyric-prev,
.lyric-next {
  opacity: 0.5;
  font-size: 14px;
}

.lyric-current {
  opacity: 1;
  font-size: 18px;
  font-weight: 600;
  color: var(--primary-color);
  transform: scale(1.1);
}

/* 滚动模式 */
.lyrics-scroll .lyric-line {
  padding: 12px 20px;
  transition: all 0.3s ease;
}

.lyrics-scroll .lyric-line.active {
  background: rgba(29, 185, 84, 0.1);
  color: var(--primary-color);
  font-weight: 600;
}
```

---

## 主题系统

### 主题切换

```typescript
import { setTheme, getTheme } from './js/theme-manager';

// 获取当前主题
const currentTheme = getTheme(); // 'light' | 'dark' | 'auto'

// 切换主题
setTheme('dark');  // 暗色主题
setTheme('light'); // 亮色主题
setTheme('auto');  // 跟随系统

// 主题切换UI
const themeToggle = document.getElementById('theme-toggle');
themeToggle?.addEventListener('click', () => {
  const current = getTheme();
  const next = current === 'light' ? 'dark' : 'light';
  setTheme(next);
});
```

### 自定义主题

```css
/* 亮色主题变量 */
[data-theme="light"] {
  --bg-primary: #ffffff;
  --bg-secondary: #f5f5f5;
  --text-primary: #000000;
  --text-secondary: #666666;
  --primary-color: #1db954;
  --border-color: #e0e0e0;
}

/* 暗色主题变量 */
[data-theme="dark"] {
  --bg-primary: #121212;
  --bg-secondary: #1e1e1e;
  --text-primary: #ffffff;
  --text-secondary: #b3b3b3;
  --primary-color: #1ed760;
  --border-color: #333333;
}

/* 使用主题变量 */
.container {
  background: var(--bg-primary);
  color: var(--text-primary);
  border: 1px solid var(--border-color);
}
```

---

## 完整示例

### 简单播放器

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>简单播放器</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div class="mini-player">
    <input type="text" id="search" placeholder="搜索歌曲...">
    <div id="results"></div>
    
    <div class="player">
      <audio id="audio"></audio>
      <div id="info"></div>
      <button id="play">播放</button>
      <button id="pause">暂停</button>
    </div>
  </div>

  <script type="module">
    import { searchSongs } from './js/api.ts';
    import { playSong, togglePlay } from './js/player.ts';
    import { debounce } from './js/utils.ts';

    const searchInput = document.getElementById('search');
    const resultsDiv = document.getElementById('results');
    const infoDiv = document.getElementById('info');

    // 搜索
    const search = debounce(async (keyword) => {
      const results = await searchSongs(keyword, 'netease');
      resultsDiv.innerHTML = results.songs
        .map(song => `
          <div class="song" data-id="${song.id}">
            ${song.name} - ${song.artist}
          </div>
        `)
        .join('');
    }, 300);

    searchInput.addEventListener('input', (e) => {
      search(e.target.value);
    });

    // 点击播放
    resultsDiv.addEventListener('click', async (e) => {
      const songDiv = e.target.closest('.song');
      if (!songDiv) return;

      const songId = songDiv.dataset.id;
      const results = await searchSongs(searchInput.value, 'netease');
      const song = results.songs.find(s => s.id === songId);
      
      if (song) {
        await playSong(song);
        infoDiv.textContent = `正在播放: ${song.name}`;
      }
    });

    // 控制按钮
    document.getElementById('play').addEventListener('click', togglePlay);
    document.getElementById('pause').addEventListener('click', togglePlay);
  </script>
</body>
</html>
```

### 完整功能播放器

```typescript
// main.ts
import { 
  playSong, 
  nextSong, 
  previousSong, 
  togglePlay,
  setVolume,
  toggleFavorite 
} from './js/player';
import { searchSongs } from './js/api';
import { displaySearchResults, showNotification } from './js/ui';
import { debounce } from './js/utils';

class MusicPlayer {
  private audio: HTMLAudioElement;
  private currentSong: Song | null = null;

  constructor() {
    this.audio = document.getElementById('audio') as HTMLAudioElement;
    this.initializeControls();
    this.initializeSearch();
    this.initializeEvents();
  }

  private initializeControls() {
    // 播放控制
    document.getElementById('play-btn')?.addEventListener('click', togglePlay);
    document.getElementById('prev-btn')?.addEventListener('click', () => previousSong());
    document.getElementById('next-btn')?.addEventListener('click', () => nextSong());
    
    // 音量控制
    const volumeSlider = document.getElementById('volume') as HTMLInputElement;
    volumeSlider?.addEventListener('input', (e) => {
      setVolume(parseFloat((e.target as HTMLInputElement).value));
    });
    
    // 收藏按钮
    document.getElementById('favorite-btn')?.addEventListener('click', () => {
      const isFavorited = toggleFavorite();
      showNotification(
        isFavorited ? '已添加到收藏' : '已取消收藏',
        'success'
      );
    });
  }

  private initializeSearch() {
    const searchInput = document.getElementById('search-input') as HTMLInputElement;
    const searchBtn = document.getElementById('search-btn');
    
    const performSearch = debounce(async (keyword: string) => {
      if (!keyword.trim()) return;
      
      try {
        const results = await searchSongs(keyword);
        displaySearchResults(results.songs);
      } catch (error) {
        showNotification('搜索失败', 'error');
      }
    }, 300);

    