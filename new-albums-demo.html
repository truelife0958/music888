<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–°ç¢Ÿä¸Šæ¶ - Music888</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/new-albums.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            color: #fff;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            padding: 40px 0;
        }
        
        .header h1 {
            font-size: 36px;
            font-weight: bold;
            margin: 0 0 10px 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .header p {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.6);
            margin: 0;
        }
        
        .section-title {
            font-size: 24px;
            font-weight: bold;
            margin: 30px 0 20px 0;
            padding-left: 12px;
            border-left: 4px solid #667eea;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å¤´éƒ¨ -->
        <div class="header">
            <h1>ğŸµ æ–°ç¢Ÿä¸Šæ¶</h1>
            <p>æ¢ç´¢æœ€æ–°å‘å¸ƒçš„éŸ³ä¹ä¸“è¾‘</p>
        </div>
        
        <!-- åœ°åŒºç­›é€‰ -->
        <div id="area-filter"></div>
        
        <!-- æ–°ç¢Ÿåˆ—è¡¨ -->
        <div class="section-title">æœ€æ–°ä¸“è¾‘</div>
        <div id="albums-container"></div>
    </div>

    <!-- ä¸“è¾‘è¯¦æƒ…å¼¹çª— -->
    <div id="album-detail-modal" class="album-detail-modal">
        <div class="album-detail-content">
            <button class="album-detail-close" onclick="closeAlbumDetail()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
            
            <div class="album-detail-header">
                <div class="album-detail-cover">
                    <img id="detail-cover" src="" alt="">
                </div>
                <div class="album-detail-info">
                    <h2 class="album-detail-title" id="detail-title"></h2>
                    <div class="album-detail-artist" id="detail-artist"></div>
                    <div class="album-detail-meta">
                        <span id="detail-publish-time"></span>
                        <span id="detail-song-count"></span>
                    </div>
                    <div class="album-detail-actions">
                        <button class="btn-play-all" onclick="playAllSongs()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 6px; vertical-align: middle;">
                                <path d="M8 5v14l11-7z"/>
                            </svg>
                            æ’­æ”¾å…¨éƒ¨
                        </button>
                        <button class="btn-add-to-playlist">
                            â• æ·»åŠ åˆ°æ­Œå•
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="album-detail-songs">
                <ul id="album-song-list" class="album-song-list"></ul>
            </div>
        </div>
    </div>

    <!-- åŠ è½½è„šæœ¬ -->
    <script type="module">
        import { renderNewAlbums, createAreaFilter, getAlbumDetail } from './js/new-albums.js';
        
        let currentArea = 'ALL';
        let currentAlbumData = null;
        
        // åˆå§‹åŒ–
        async function init() {
            // åˆ›å»ºåœ°åŒºç­›é€‰å™¨
            createAreaFilter('area-filter', async (area) => {
                currentArea = area;
                await renderNewAlbums('albums-container', area);
            });
            
            // åŠ è½½é»˜è®¤ä¸“è¾‘åˆ—è¡¨
            await renderNewAlbums('albums-container', currentArea);
            
            // ç›‘å¬è‡ªå®šä¹‰äº‹ä»¶
            document.addEventListener('showAlbumDetail', async (e) => {
                await showAlbumDetail(e.detail.albumId);
            });
            
            document.addEventListener('playAlbum', (e) => {
                console.log('æ’­æ”¾ä¸“è¾‘:', e.detail.album.name);
                console.log('æ­Œæ›²åˆ—è¡¨:', e.detail.songs);
                alert(`å¼€å§‹æ’­æ”¾ä¸“è¾‘ï¼š${e.detail.album.name}\nåŒ…å« ${e.detail.songs.length} é¦–æ­Œæ›²`);
            });
        }
        
        // æ˜¾ç¤ºä¸“è¾‘è¯¦æƒ…
        async function showAlbumDetail(albumId) {
            const modal = document.getElementById('album-detail-modal');
            modal.classList.add('show');
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            document.getElementById('detail-title').textContent = 'åŠ è½½ä¸­...';
            document.getElementById('album-song-list').innerHTML = '<li style="text-align: center; padding: 40px; color: rgba(255,255,255,0.5);">åŠ è½½ä¸­...</li>';
            
            try {
                const result = await getAlbumDetail(albumId);
                if (!result) {
                    throw new Error('è·å–ä¸“è¾‘è¯¦æƒ…å¤±è´¥');
                }
                
                currentAlbumData = result;
                
                // æ›´æ–°UI
                document.getElementById('detail-cover').src = result.album.picUrl + '?param=300y300';
                document.getElementById('detail-title').textContent = result.album.name;
                document.getElementById('detail-artist').textContent = result.album.artist.join(', ');
                
                const publishDate = new Date(result.album.publishTime);
                document.getElementById('detail-publish-time').textContent = publishDate.toLocaleDateString('zh-CN');
                document.getElementById('detail-song-count').textContent = `${result.songs.length} é¦–æ­Œæ›²`;
                
                // æ¸²æŸ“æ­Œæ›²åˆ—è¡¨
                const songList = document.getElementById('album-song-list');
                songList.innerHTML = result.songs.map((song, index) => `
                    <li class="album-song-item" onclick="playSong('${song.id}', '${song.name}')">
                        <div class="album-song-number">${String(index + 1).padStart(2, '0')}</div>
                        <div class="album-song-info">
                            <div class="album-song-name">${song.name}</div>
                            <div class="album-song-artist">${song.artist.join(', ')}</div>
                        </div>
                        <div class="album-song-duration">--:--</div>
                    </li>
                `).join('');
                
            } catch (error) {
                console.error('æ˜¾ç¤ºä¸“è¾‘è¯¦æƒ…å¤±è´¥:', error);
                document.getElementById('album-song-list').innerHTML = '<li style="text-align: center; padding: 40px; color: #f56c6c;">åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•</li>';
            }
        }
        
        // å…³é—­ä¸“è¾‘è¯¦æƒ…
        window.closeAlbumDetail = function() {
            const modal = document.getElementById('album-detail-modal');
            modal.classList.remove('show');
            currentAlbumData = null;
        };
        
        // æ’­æ”¾æ‰€æœ‰æ­Œæ›²
        window.playAllSongs = function() {
            if (!currentAlbumData) return;
            
            console.log('æ’­æ”¾å…¨éƒ¨:', currentAlbumData.songs);
            alert(`å¼€å§‹æ’­æ”¾ä¸“è¾‘ï¼š${currentAlbumData.album.name}\nåŒ…å« ${currentAlbumData.songs.length} é¦–æ­Œæ›²`);
        };
        
        // æ’­æ”¾å•æ›²
        window.playSong = function(songId, songName) {
            console.log('æ’­æ”¾æ­Œæ›²:', songId, songName);
            alert(`æ’­æ”¾æ­Œæ›²ï¼š${songName}`);
        };
        
        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        document.getElementById('album-detail-modal').addEventListener('click', (e) => {
            if (e.target.classList.contains('album-detail-modal')) {
                closeAlbumDetail();
            }
        });
        
        // ESCé”®å…³é—­
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeAlbumDetail();
            }
        });
        
        // å¯åŠ¨åº”ç”¨
        init();
    </script>
</body>
</html>